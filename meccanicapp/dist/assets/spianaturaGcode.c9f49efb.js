import"./style.7bbbca57.js";let z=document.getElementById("lunghezza-pezzo-input"),P=document.getElementById("larghezza-pezzo-input"),T=document.getElementById("altezza-pezzo-input"),X=document.getElementById("avanzamento-per-dente-input"),_=document.getElementById("velocita-di-taglio-input"),M=document.getElementById("numero-denti-fresa-input"),B=document.getElementById("percentuale-lavorazione-input"),A=document.getElementById("isAnimato-input"),Z=document.getElementById("diametro-utensile-input"),S=document.querySelector("#success-alert"),b=document.querySelector("#perc-gcode"),k=document.querySelector("#changes-alert"),F=document.querySelector("#spianatura-output"),L=document.querySelector("#output-gcode"),q=0;document.querySelector("#copia-buttone").style.display="none";[P,z].forEach(e=>{e.addEventListener("input",l=>{let n=l.target.value,t=n.length;t>1&&(e.style.width=t+1.3+"rem"),t>4&&(I("Errore: numero troppo grande."),e.value=n.slice(0,-1),e.style.width=t+.5+"rem")})});Z.addEventListener("input",e=>{let l=e.target.value;l.length>3&&(I("Errore: numero troppo grande."),e.target.value=l.slice(0,-1))});document.getElementById("output-gcode");let j={},h={},f={},a=[],g,m,u,D=document.querySelector("#btn-form");function N(e,l){p(),y(),n(l),t(e),s();function n(i){a.push(`WORKPIECE(,"",, "BOX",64, ${i.Z0}, -${i.Z0-1-(i.Z0-1)}, -80, 0, -${i.Y0}, ${i.X0}, ${i.Y0})`)}function t(i){i.absolute?a.push("G90"):a.push("G91")}function s(){a.push("G54")}function p(){a=[]}function y(){g=0,m=0,u=0}}function U(e){l(e),n(e);function l(t){(t.diametro==null||t.diametro==null||t.diametro==""||t.diametro==0||isNaN(t.diametro))&&(t.diametro=20),s(t);function s(p){a.push(`T="CUTTER ${p.diametro}"`),a.push("M6")}}function n(t){t.speed!=null&&t.speed!=""&&t.speed!=null?a.push(`S${t.speed} M3`):a.push("S1000 M3")}}function E(e,l,n){let t=Y(e,l,n);a.push(`G0 X${t.x%1==0?t.x:t.x.toFixed(1)} Y${t.y%1==0?t.y:t.y.toFixed(1)} Z${t.z%1==0?t.z:t.z.toFixed(1)}`),$(t.x,t.y,t.z)}function v(e,l,n){let t=Y(e,l,n);a.push(`G1 X${t.x%1==0?t.x:t.x.toFixed(1)} Y${t.y%1==0?t.y:t.y.toFixed(1)} Z${t.z%1==0?t.z:t.z.toFixed(1)}`),$(t.x,t.y,t.z)}function Y(e,l,n){return(e==null||e==null||e=="")&&(g!=null||g!=null||g!=""?e=g:e=0),(l==null||l==null||l=="")&&(m!=null||m!=null||m!=""?l=m:l=0),(n==null||n==null||n=="")&&(u!=null||u!=null||u!=""?n=u:n=0),{x:e,y:l,z:n}}function V(e){let l=0-e.diametro/2-2,n=e.diametro/2-e.diamPercMisura;E(l,n,e.Z0-1)}function $(e,l,n){g=e,f.previusX=g,m=l,f.previusY=m,u=n,f.previusZ=u}function O(e){let l=!1,n=Math.floor(e.Y0/e.diamPercMisura),t=e.Z0-1;for(let r=t;r>=0;r--){let d=0-e.diametro/2-2,o=e.diametro/2-e.diamPercMisura;u=r,E(d,o,u);for(let c=1;c<=n;c++)c==1&&a.push(`F${e.feed}`),l?(p(),y()):(s(e),y()),c==n&&i(e,l)}function s(r){v(r.X0+2,"",""),l=!0}function p(){v(0-2,"",""),l=!1}function y(){v("",m-e.diamPercMisura,"")}function i(r,d){let o=r.X0+r.diametro/2+2,c=0-r.diametro/2-2;d?(v(c,"",""),C(),d=!1):(v(o,"",""),C(),d=!0);function C(ee){v("","",u+2),E("","",0+20)}}}function H(){a.push("M30")}function R(e,l){return N(e,l),U(e),V(e),O(e),H(),a}D.addEventListener("click",()=>{j={X0:parseInt(z.value),Y0:parseInt(P.value),Z0:parseInt(T.value)},h={vt:parseInt(_.value),Fz:parseFloat(X.value),n_denti:parseInt(M.value),feed:f.feed,speed:f.speed,diametro:parseInt(Z.value),percLavorazUtensile:parseInt(B.value)},f={absolute:!0,feed:parseInt(K(h)),speed:parseInt(x(h)),diametro:h.diametro,percLavorazUtensile:h.percLavorazUtensile,diamPercMisura:h.diametro/100*h.percLavorazUtensile,X0:j.X0,Y0:j.Y0,Z0:j.Z0,nameGprogram:"undefined, there isn't a name (this functionality isn't working now)"},Q(),W(f,j),document.querySelector("#copia-buttone").style.display="grid",document.querySelector("#bottom-footer-info").style.display="flex"});function W(e,l){document.querySelector("#output-gcode").innerHTML="",document.querySelector("#spianatura-output").classList.add("withCodeInside");let n=R(e,l);n.forEach((t,s)=>{A.checked?setTimeout(()=>{y(t,s,n)},s*1e3/30):p(t,s,n);function p(i,r,d){let o=document.createElement("div"),c=document.querySelector("#template-g-line").content.cloneNode(!0);o.appendChild(c),document.querySelector("#output-gcode").appendChild(o),o.querySelector(".gcode-line").textContent=i,o.querySelector(".gnum-line").textContent=`N${r+1}`,o.classList.add("gcode-line"),o.scrollIntoView({behaviour:"smooth"}),G(d,r)}function y(i,r,d){let o=document.createElement("div"),c=document.querySelector("#template-g-line").content.cloneNode(!0);o.appendChild(c),document.querySelector("#output-gcode").appendChild(o),o.querySelector(".gcode-line").textContent=i,o.querySelector(".gnum-line").textContent=`N${r+1}`,hljs.highlightElement(o.querySelector(".gcode-line")),o.scrollIntoView({}),G(d,r)}})}function x(e){return Math.round(e.vt*1e3/(e.diametro*Math.PI))}function K(e){return Math.round(e.Fz*e.n_denti*x(e))}function I(e){let l=document.querySelector("#alert");l.classList.add("alert-visible"),l.querySelector("#testo-errore").textContent=e,setTimeout(()=>{l.classList.remove("alert-visible")},2e3)}function G(e,l){S.classList.remove("success-visible"),S.classList.add("success-alltime");let t=100/e.length*(l+1);S.style.width=`${t}%`,b.textContent=`${t.toFixed(1)}%`,b.style=`font-size: 1.5rem; font-weight: bold; position: absolute; left: calc(${t}vw - 3rem); background: var(--alert-green); padding: 0.1rem 0.5rem; border-radius: 0 0 0.5rem 0.5rem; opacity: 1;`,l+1==e.length&&(S.classList.remove("success-alltime"),b.style="opacity: 0;")}document.querySelector("#copia-buttone").style.display="none";document.querySelector("#copia-buttone").addEventListener("click",()=>{let e=a.join(`
`);navigator.clipboard.writeText(e).then(()=>{e.length>0?(document.querySelector("#copia-buttone").classList.add("copia-success"),setTimeout(()=>{document.querySelector("#copia-buttone").classList.remove("copia-success")},1e3)):I("il testo \xE8 vuoto, prova a generare il gcode prima di copiarlo")}).catch(l=>{console.error(l),I(l)})});const w=document.querySelector("#go-to-top");w.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});window.addEventListener("scroll",()=>{window.scrollY>100?w.style.display="grid":w.style.display="none"});document.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>{document.querySelector("#spianatura-output").classList.contains("withCodeInside")&&(q++,q<=1&&(console.log("\u2705 there is some modifications after last save"),J()))})});function J(){k.style.display="flex",F.style.padding="0px",L.style.display="grid",L.style.padding="0.5rem 1rem"}function Q(){q=0,console.log("removed"),k.style.display="none",F.style.padding="",L.style.padding=""}
